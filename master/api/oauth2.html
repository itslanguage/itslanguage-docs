<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>OAuth2 - ITSLanguage API</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "OAuth2";
    var mkdocs_page_input_path = "api/oauth2.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ITSLanguage API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Home</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../index.html">ITSLanguage Speech API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">REST API basics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="authentication.html">Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="cors.html">Cross Origin Resource Sharing</a>
                </li>
                <li class="">
                    
    <a class="" href="data_representation.html">Data representation</a>
                </li>
                <li class="">
                    
    <a class="" href="jsonp.html">JSON-P Callbacks</a>
                </li>
                <li class="">
                    
    <a class="" href="pagination.html">Pagination</a>
                </li>
                <li class="">
                    
    <a class="" href="parameters.html">Parameters</a>
                </li>
                <li class="">
                    
    <a class="" href="request_response_format.html">Request and response format</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="roles.html">Roles</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="permissions.html">Permissions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="ssl.html">SSL</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="errors.html">Error handling</a>
                </li>
                <li class="">
                    
    <a class="" href="filters.html">Filters</a>
                </li>
                <li class="">
                    
    <a class="" href="urls.html">URLs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">REST API</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="oauth2.html">OAuth2</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#oauth2">OAuth2</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#obtain-access-token">Obtain access token</a></li>
        
            <li><a class="toctree-l4" href="#using-the-access-token">Using the access token</a></li>
        
            <li><a class="toctree-l4" href="#impersonation">Impersonation</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="organisations.html">Organisations</a>
                </li>
                <li class="">
                    
    <a class="" href="students.html">Students</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Challenges</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="speech_challenges.html">Speech</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="pronunciation_challenges.html">Pronunciation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="choice_challenges.html">Choice</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="progress.html">Progress</a>
                </li>
                <li class="">
                    
    <a class="" href="recordings.html">Speech Recordings</a>
                </li>
                <li class="">
                    
    <a class="" href="feedback.html">Speech Feedback</a>
                </li>
                <li class="">
                    
    <a class="" href="analyses.html">Speech Analysis</a>
                </li>
                <li class="">
                    
    <a class="" href="recognitions.html">Speech Recognition</a>
                </li>
                <li class="">
                    
    <a class="" href="categories.html">Category</a>
                </li>
                <li class="">
                    
    <a class="" href="tenants.html">Tenants</a>
                </li>
                <li class="">
                    
    <a class="" href="groups.html">Groups</a>
                </li>
                <li class="">
                    
    <a class="" href="profiles.html">Profiles</a>
                </li>
                <li class="">
                    
    <a class="" href="assignments.html">Assignments</a>
                </li>
                <li class="">
                    
    <a class="" href="annotations.html">Annotations</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Users</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="users.html">Users</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="basicauths.html">Basic authentication</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="emailauth.html">Email authentication</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Websocket API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../websocket/wamp.html">WAMP</a>
                </li>
                <li class="">
                    
    <a class="" href="../websocket/feedback.html">Speech Feedback</a>
                </li>
                <li class="">
                    
    <a class="" href="../websocket/speech_recording.html">Speech Recording</a>
                </li>
                <li class="">
                    
    <a class="" href="../websocket/pronunciation_analyses.html">Pronunciation Analyses</a>
                </li>
                <li class="">
                    
    <a class="" href="../websocket/choice_recognitions.html">Choice Recognitions</a>
                </li>
                <li class="">
                    
    <a class="" href="../websocket/audio.html">Audio</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ITSLanguage API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>REST API &raquo;</li>
        
      
    
    <li>OAuth2</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/itslanguage/itslanguage-docs/edit/master/docs/api/oauth2.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="oauth2"><a class="toclink" href="#oauth2">OAuth2</a></h1>
<p>Access tokens may be requested by users to grant them access.</p>
<p>An access token can be used to make an authorised request. To do so, the
access token should be passed as an <a href="#using-the-access-token">authorization request
header</a>.</p>
<h2 id="obtain-access-token"><a class="toclink" href="#obtain-access-token">Obtain access token</a></h2>
<p>An access token can either be requested using a manual request or by using an
OAuth2 compatible client.</p>
<h3 id="request"><a class="toclink" href="#request">Request</a></h3>
<p>To request an access token, a POST request should be done to the access token
API. The body should contain the username, password, grant type (<code>password</code>)
and optional scope. To request an access token for the user <code>tenant</code> with
password <code>secret</code> and scope <code>tenant/tenant</code>, the request should look like this:</p>
<pre><code class="http">POST https://api.itslanguage.io/tokens HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Accept: application/json

grant_type=password&amp;username=tenant&amp;password=secret&amp;scope=tenant%2Ftenant
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The scope <strong>is required</strong> when authenticating as a user in an organisation,
using a username and password. This is because a user is only unique within
the organisation and there is no way of determining the organisation from
the username alone. For a user with the username <code>bob</code> in the organisation
<code>org</code> in tenant <code>ten</code> the scope should be
<code>tenant/ten/organisation/org/user/bob</code>.
When using email authentication, passing the scope is not neccesary.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>Content-Type</code> of the request is different from the response.</p>
</div>
<h3 id="response"><a class="toclink" href="#response">Response</a></h3>
<p>When the supplied credentials are valid, an access token is returned as a JSON
response:</p>
<pre><code class="http">HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
    &quot;access_token&quot;: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJI&quot;,
    &quot;token_type&quot;: &quot;Bearer&quot;,
    &quot;scope&quot;: &quot;tenant/tenant&quot;
}
</code></pre>

<h2 id="using-the-access-token"><a class="toclink" href="#using-the-access-token">Using the access token</a></h2>
<p>The access token can be used to make an authorised request. To do so, the
access token should be placed in the Authorization header as a bearer token.
Example:</p>
<pre><code class="http">GET https://api.itslanguage.io/organisations HTTP/1.1
Accept: application/json
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJI
</code></pre>

<p>In cases where it is not possible to use the <code>Authorization</code> header, the token
can be supplied using a request parameter:</p>
<pre><code class="http">GET https://api.itslanguage.io/organisations?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJI HTTP/1.1
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example access tokens are shortened for demo purposes.</p>
</div>
<h2 id="impersonation"><a class="toclink" href="#impersonation">Impersonation</a></h2>
<p>It is possible to impersonate another user by using the <code>client_credentials</code>
grant type and supplying a scope that represents the impersonation target.
This can be convenient for a variety of reasons.</p>
<p>When a tenant wants to perform authentication for its users instead of using
the built in authentication, the tenant can use its credentials to request
tokens for its users. The token can be relayed to the end-user so the tenant
actually authenticated and impersonated the user.</p>
<p>When a top level admin user wants to perform administrative tasks for a
tenant/organisation, the admin can impersonate the appropriate
tenant/organisation.</p>
<p>Impersonation is allowed top-down; a tenant can impersonate an
organisation or user but a user can't impersonate any of them.
Depending on the user's privileges a user may or may not impersonate. (A
tenant admin user may impersonate the same way a tenant can for example.)</p>
<h3 id="example-scopes"><a class="toclink" href="#example-scopes">Example scopes</a></h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user/barry</code></td>
<td>Top level admin user with id <code>barry</code></td>
</tr>
<tr>
<td><code>tenant/ten</code></td>
<td>Tenant with id <code>ten</code></td>
</tr>
<tr>
<td><code>tenant/demo/organisation/org</code></td>
<td>Organisation <code>org</code> in tenant <code>demo</code></td>
</tr>
<tr>
<td><code>tenant/demo/organisation/org/student/stu</code></td>
<td>Student <code>stu</code> in organisation <code>org</code> in tenant <code>demo</code></td>
</tr>
</tbody>
</table>
<h3 id="request_1"><a class="toclink" href="#request_1">Request</a></h3>
<p>To request an access token a POST request should be done to the access token
API. The body (<code>application/x-www-form-urlencoded</code>) should contain the target
scope and the grant type (<code>client_credentials</code>). The request should also
contain a previously received access token in the <code>Authorization</code> header as
described in <a href="#using-the-access-token">Using the access token</a>.
Example request:</p>
<pre><code class="http">POST https://api.itslanguage.io/tokens HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Accept: application/json
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJI

grant_type=client_credentials&amp;scope=tenant%2Facmecorp

</code></pre>

<p>If the authentication succeeds the access token is returned as <a href="#response">usual</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If no scope is supplied (which is valid in the OAuth2 spec), an access
token for the current user is returned (meaning no impersonation takes
place).</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="organisations.html" class="btn btn-neutral float-right" title="Organisations">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="urls.html" class="btn btn-neutral" title="URLs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>2013-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/itslanguage/itslanguage-docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="urls.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="organisations.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
